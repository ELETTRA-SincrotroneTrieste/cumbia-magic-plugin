<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>cumbia-magic plugin: Add some cumbia magic to simple Qt widgets</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">cumbia-magic plugin
   &#160;<span id="projectnumber">1.0.x</span>
   </div>
   <div id="projectbrief">Transform any Qt object (QObject, QWidget, ...) into a cumbia reader</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Add some cumbia magic to simple Qt widgets </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Introduction"></a>
Introduction</h1>
<h2><a class="anchor" id="includes_init"></a>
Includes and plugin initialization</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="cumagicplugininterface_8h.html">cumagicplugininterface.h</a>&gt;</span></div>
<div class="line"><span class="comment">// load magic plugin</span></div>
<div class="line">QObject *magic_plo;</div>
<div class="line"><a class="code" href="classCuMagicPluginInterface.html">CuMagicPluginInterface</a> *plugin_i = <a class="code" href="classCuMagicPluginInterface.html#ac15c589ce48f03bb5a7f0d1221e420d3">CuMagicPluginInterface::get_instance</a>(cumbia_pool, m_ctrl_factory_pool, magic_plo);</div>
<div class="line"><span class="keywordflow">if</span>(!plugin_i)</div>
<div class="line">     perr(<span class="stringliteral">&quot;MyMagicApp: failed to load plugin \&quot;%s\&quot;&quot;</span>, <a class="code" href="classCuMagicPluginInterface.html#a8b980b93577b03ac22f592cd87660f61">CuMagicPluginInterface::file_name</a>);</div>
<div class="line"> <span class="keywordflow">else</span> { <span class="comment">// magic here</span></div>
<div class="line"> }</div>
<div class="ttc" id="aclassCuMagicPluginInterface_html"><div class="ttname"><a href="classCuMagicPluginInterface.html">CuMagicPluginInterface</a></div><div class="ttdef"><b>Definition:</b> cumagicplugininterface.h:281</div></div>
<div class="ttc" id="aclassCuMagicPluginInterface_html_a8b980b93577b03ac22f592cd87660f61"><div class="ttname"><a href="classCuMagicPluginInterface.html#a8b980b93577b03ac22f592cd87660f61">CuMagicPluginInterface::file_name</a></div><div class="ttdeci">static constexpr const char file_name[32]</div><div class="ttdef"><b>Definition:</b> cumagicplugininterface.h:336</div></div>
<div class="ttc" id="aclassCuMagicPluginInterface_html_ac15c589ce48f03bb5a7f0d1221e420d3"><div class="ttname"><a href="classCuMagicPluginInterface.html#ac15c589ce48f03bb5a7f0d1221e420d3">CuMagicPluginInterface::get_instance</a></div><div class="ttdeci">static CuMagicPluginInterface * get_instance(CumbiaPool *cu_poo, const CuControlsFactoryPool &amp;fpoo, QObject *plugin_qob)</div><div class="ttdoc">CuMagicPluginInterface::get_instance returns a new instance of the plugin.</div><div class="ttdef"><b>Definition:</b> cumagicplugininterface.h:323</div></div>
<div class="ttc" id="acumagicplugininterface_8h_html"><div class="ttname"><a href="cumagicplugininterface_8h.html">cumagicplugininterface.h</a></div></div>
</div><!-- fragment --><p>The cumbia-magic-plugin allows to read data through the cumbia engine and display it on a generic widget (or even a simple QObject) through its properties. For example, a scalar number can be set on a progress bar, displayed as text on either a QLineEdit or QLabel or as a number in either a QDoubleSpinBox or a QLCDNumber. Configuration properties (<em>min, max, format, display_unit</em>) are used to set the minimum and maximum properties of an object, if relevant. <em>format</em> is used to display numbers as text. The <em>display_unit</em> is appended to the text if either the property <em>displayUnitEnabled is not defined or defined and set to true</em>.</p>
<dl class="section note"><dt>Note</dt><dd>The <em>displayUnitEnabled</em> property is the same used in QuLabel for the same purpose.</dd></dl>
<h3><a class="anchor" id="prop_name_mapping"></a>
Property names mapping</h3>
<p>The default property names can be mapped into those available on the custom object if they match the semantics, without need adding new properties just to match names. For example, if a plot has the two properties</p>
<ul>
<li>yLowerBound </li>
<li>yUpperBound</li>
</ul>
<p>they can be used after mapping <em>max</em> into <em>yUpperBound</em> and <em>min</em> into <em>yLowerBound</em>:</p>
<div class="fragment"><div class="line"><a class="code" href="classCuMagicI.html">CuMagicI</a> *ma = plugin_i-&gt;<a class="code" href="classCuMagicPluginInterface.html#a9dab1cbc275602390203d6f04c9493f5">new_magic</a>(ui-&gt;plot, <span class="stringliteral">&quot;$1/double_spectrum&quot;</span>, <span class="stringliteral">&quot;setData&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// if min and max configuration properties are available, use them to set yLowerBound and yUpperBound on the</span></div>
<div class="line"><span class="comment">// plot, respectively</span></div>
<div class="line">ma-&gt;<a class="code" href="classCuMagicI.html#a53dd27becdfc4f08070f257adabe06cb">mapProperty</a>(<span class="stringliteral">&quot;min&quot;</span>, <span class="stringliteral">&quot;yLowerBound&quot;</span>);</div>
<div class="line">ma-&gt;<a class="code" href="classCuMagicI.html#a53dd27becdfc4f08070f257adabe06cb">mapProperty</a>(<span class="stringliteral">&quot;max&quot;</span>, <span class="stringliteral">&quot;yUpperBound&quot;</span>);</div>
<div class="ttc" id="aclassCuMagicI_html"><div class="ttname"><a href="classCuMagicI.html">CuMagicI</a></div><div class="ttdef"><b>Definition:</b> cumagicplugininterface.h:28</div></div>
<div class="ttc" id="aclassCuMagicI_html_a53dd27becdfc4f08070f257adabe06cb"><div class="ttname"><a href="classCuMagicI.html#a53dd27becdfc4f08070f257adabe06cb">CuMagicI::mapProperty</a></div><div class="ttdeci">virtual void mapProperty(const QString &amp;from, const QString &amp;to)=0</div><div class="ttdoc">mapProperty instruct CuMagic to use property to instead of from</div></div>
<div class="ttc" id="aclassCuMagicPluginInterface_html_a9dab1cbc275602390203d6f04c9493f5"><div class="ttname"><a href="classCuMagicPluginInterface.html#a9dab1cbc275602390203d6f04c9493f5">CuMagicPluginInterface::new_magic</a></div><div class="ttdeci">virtual CuMagicI * new_magic(QObject *target, const QString &amp;source=QString(), const QString &amp;property=QString()) const =0</div><div class="ttdoc">get_magic returns a new CuMagicI object with target the given QObject and source</div></div>
</div><!-- fragment --><h2><a class="anchor" id="scalar_on_scalar"></a>
Scalar value on a scalar display widget</h2>
<p>Scalar data is naturally mapped into display scalar widgets with a <em>one liner</em>:</p>
<div class="fragment"><div class="line"><a class="code" href="classCuMagicI.html">CuMagicI</a> *ma0 = plugin_i-&gt;<a class="code" href="classCuMagicPluginInterface.html#a9dab1cbc275602390203d6f04c9493f5">new_magic</a>(ui-&gt;lcdNumber, <span class="stringliteral">&quot;$1/double_scalar&quot;</span>);</div>
<div class="line"><a class="code" href="classCuMagicI.html">CuMagicI</a> *ma1 = plugin_i-&gt;<a class="code" href="classCuMagicPluginInterface.html#a9dab1cbc275602390203d6f04c9493f5">new_magic</a>(ui-&gt;progressBar, <span class="stringliteral">&quot;$1/short_scalar&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="array_el_on_scalar"></a>
One element of an array on a scalar display widget</h2>
<p>An element of an array can be picked and used as a scalar:</p>
<div class="fragment"><div class="line"><a class="code" href="classCuMagicI.html">CuMagicI</a> *ma2 = plugin_i-&gt;<a class="code" href="classCuMagicPluginInterface.html#a9dab1cbc275602390203d6f04c9493f5">new_magic</a>(ui-&gt;x0_2, <span class="stringliteral">&quot;$1/double_spectrum[0]&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="subset_of_vector"></a>
Subset of a vector onto a vector display widget</h2>
<p>A subset of elements of a vectorial quantity can be defined and displayed on a spectrum oriented widget, such as a plot:</p>
<div class="fragment"><div class="line"><span class="comment">// Let a custom plot be defined as this:</span></div>
<div class="line"> <span class="keyword">class </span>MyDisplayVector : <span class="keyword">public</span> QuPlotBase {</div>
<div class="line">     Q_OBJECT</div>
<div class="line">     Q_PROPERTY(QList&lt;double&gt; myData READ myData WRITE setMyData) <span class="comment">// property to access myData</span></div>
<div class="line"> <span class="keyword">public</span>:</div>
<div class="line">     MyDisplayVector(QWidget *parent); <span class="comment">// constructor</span></div>
<div class="line">     <span class="keywordtype">void</span> setMyData(<span class="keyword">const</span> QList&lt;double&gt; &amp;y);  <span class="comment">// update plot curve</span></div>
<div class="line">     QList&lt;double&gt; myData() <span class="keyword">const</span>; <span class="comment">// return the curve y values</span></div>
<div class="line"> <span class="comment">// ...</span></div>
<div class="line"> };</div>
<div class="line"> </div>
<div class="line"><span class="comment">// ui-&gt;plot is a MyDisplayVector, derived from QuPlotBase</span></div>
<div class="line"><span class="comment">// pick values at indexes 1 to 10, then other three times the element 10, elements 15,16 and finally 20 to 26</span></div>
<div class="line"><span class="comment">// use the &quot;myData&quot; property on the plot for updates</span></div>
<div class="line"><a class="code" href="classCuMagicI.html">CuMagicI</a> *ma3 = plugin_i-&gt;<a class="code" href="classCuMagicPluginInterface.html#a9dab1cbc275602390203d6f04c9493f5">new_magic</a>(ui-&gt;plot, <span class="stringliteral">&quot;$1/double_spectrum_ro[1-10,10,10,10,15,16,20-26]&quot;</span>, <span class="stringliteral">&quot;myData&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// if min and max configuration properties are available, use them to set yLowerBound and yUpperBound on the</span></div>
<div class="line"><span class="comment">// plot, respectively</span></div>
<div class="line">ma3-&gt;<a class="code" href="classCuMagicI.html#a53dd27becdfc4f08070f257adabe06cb">mapProperty</a>(<span class="stringliteral">&quot;min&quot;</span>, <span class="stringliteral">&quot;yLowerBound&quot;</span>);</div>
<div class="line">ma3-&gt;<a class="code" href="classCuMagicI.html#a53dd27becdfc4f08070f257adabe06cb">mapProperty</a>(<span class="stringliteral">&quot;max&quot;</span>, <span class="stringliteral">&quot;yUpperBound&quot;</span>);</div>
</div><!-- fragment --><h2><a class="anchor" id="vector_on_multiple_scalar"></a>
Vector elements across display scalar widgets</h2>
<p>Elements of a vectorial quantity can be displayed each on dedicated widgets:</p>
<div class="fragment"><div class="line"><a class="code" href="classCuMagicI.html">CuMagicI</a> *ma_v_spinb = plugin_i-&gt;<a class="code" href="classCuMagicPluginInterface.html#a9dab1cbc275602390203d6f04c9493f5">new_magic</a>(<span class="keyword">this</span>, <span class="stringliteral">&quot;$1/double_spectrum&quot;</span>);</div>
<div class="line"><span class="comment">// &quot;x0&quot;, ... &quot;x4&quot; are the object names of five QDoubleSpinBox</span></div>
<div class="line">ma_v_spinb-&gt;<a class="code" href="classCuMagicI.html#a20faf04737ee727850a4e2ba34487385">map</a>(0, <span class="stringliteral">&quot;x0&quot;</span>); <span class="comment">// element 0 of double_spectrum is displayed on QDoubleSpinBox &quot;x0&quot;</span></div>
<div class="line">ma_v_spinb-&gt;<a class="code" href="classCuMagicI.html#a20faf04737ee727850a4e2ba34487385">map</a>(1, <span class="stringliteral">&quot;x1&quot;</span>);</div>
<div class="line">ma_v_spinb-&gt;<a class="code" href="classCuMagicI.html#a20faf04737ee727850a4e2ba34487385">map</a>(2, <span class="stringliteral">&quot;x2&quot;</span>);</div>
<div class="line">ma_v_spinb-&gt;<a class="code" href="classCuMagicI.html#a20faf04737ee727850a4e2ba34487385">map</a>(3, <span class="stringliteral">&quot;x3&quot;</span>);</div>
<div class="line">ma_v_spinb-&gt;<a class="code" href="classCuMagicI.html#a20faf04737ee727850a4e2ba34487385">map</a>(4, <span class="stringliteral">&quot;x4&quot;</span>);</div>
<div class="ttc" id="aclassCuMagicI_html_a20faf04737ee727850a4e2ba34487385"><div class="ttname"><a href="classCuMagicI.html#a20faf04737ee727850a4e2ba34487385">CuMagicI::map</a></div><div class="ttdeci">virtual void map(size_t idx, const QString &amp;onam)=0</div></div>
</div><!-- fragment --><h2><a class="anchor" id="def_prop"></a>
Default properties</h2>
<h3><a class="anchor" id="def_prop_update"></a>
On update</h3>
<p>A set of properties is searched on an object by default, in this order: </p><ul>
<li>value </li>
<li>checked </li>
<li>text</li>
</ul>
<p>The type of the property is identified, and the type of the data is converted accordingly. The supported types are:</p>
<ul>
<li>QVector&lt;double&gt; </li>
<li>QList&lt;double&gt; </li>
<li>QVector&lt;int&gt; </li>
<li>QList&lt;int&gt; </li>
<li>QMetaType::Int: </li>
<li>QMetaType::LongLong: </li>
<li>QMetaType::Long: </li>
<li>QMetaType::UInt: </li>
<li>QMetaType::UShort: </li>
<li>QMetaType::UChar: </li>
<li>QMetaType::ULongLong: </li>
<li>QMetaType::ULong: </li>
<li>QMetaType::Double: </li>
<li>QMetaType::Float: </li>
<li>QMetaType::Bool: </li>
<li>QVariant::String: </li>
<li>QVariant::StringList:</li>
</ul>
<h3><a class="anchor" id="def_prop_config"></a>
On configuration</h3>
<p>On configuration (when CuData <em>type</em> equals <em>property</em>), the following default properties are searched on the object:</p>
<ul>
<li>min </li>
<li>max</li>
</ul>
<p>The following other configuration keys are used, if available:</p>
<ul>
<li>display_unit: if the object has a <em>suffix</em> property (e.g. QSpinBox, QDoubleSpinBox) or the property used to show a numeric value is a string, the <em>display_unit</em> is appended. </li>
<li>format: if applicable, the number is formatted accordingly.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>For the Tango engine, the <em>display_unit</em> and <em>format</em> options are stored in the Tango database as attribute properties. </dd></dl>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
